name: Gerar Bandeiras

on:
  schedule:
    - cron: '0 0 * * *' # Roda todo dia à meia-noite
  workflow_dispatch: # Permite rodar manualmente

permissions:
  contents: write

jobs:
  cozinhar:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      # --- O NOVO TRUQUE (KIT COMPLETO) ---
      - name: Baixar Kit Completo (Bandeiras + Arquivos)
        run: |
          # Baixa o código original do bot que tem tudo
          wget https://github.com/antooro/FlagsMashupBot/archive/refs/heads/master.zip -O kit.zip
          unzip -q kit.zip
          
          # Copia TUDO (bandeiras, colors, countries) para a pasta principal
          # O -n impede que ele apague seu cook.py se tiver conflito
          cp -rn FlagsMashupBot-master/* .
          
          # Garante que a pasta flags está no lugar certo
          if [ -d "FlagsMashupBot-master/flags" ]; then cp -r FlagsMashupBot-master/flags .; fi
          
          # Limpeza
          rm kit.zip
          rm -rf FlagsMashupBot-master
          echo "Ingredientes baixados com sucesso!"

      - name: Instalar Dependências do Linux
        run: |
          sudo apt-get update
          sudo apt-get install -y libcairo2-dev pkg-config python3-dev

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Instalar Bibliotecas
        run: |
          pip install pycairo
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # Roda o nosso cozinheiro
      - name: Rodar o Cook
        run: python cook.py

      - name: Salvar Imagens
        run: |
          git config --global user.name 'Bot Cozinheiro'
          git config --global user.email 'bot@noreply.github.com'
          git add img_bandeiras
          git commit -m "Novas bandeiras geradas" || echo "Nada novo para salvar"
          git push
