name: Gerar Bandeiras

on:
  schedule:
    - cron: '0 0 * * *' # Roda todo dia à meia-noite
  workflow_dispatch: # Permite rodar manualmente

permissions:
  contents: write

jobs:
  cozinhar:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      # --- O TRUQUE MÁGICO COMEÇA AQUI ---
      # O robô vai baixar as bandeiras sozinho, você não precisa subir nada!
      - name: Baixar Ingredientes (Bandeiras)
        run: |
          # Baixa o pacote de bandeiras da internet
          wget https://github.com/hjnilsson/country-flags/archive/refs/heads/master.zip -O flags.zip
          # Abre o pacote
          unzip -q flags.zip
          # Renomeia a pasta para 'flags' pro cozinheiro achar
          mv country-flags-master/svg flags
          # Limpa o lixo
          rm flags.zip
          rm -rf country-flags-master
          echo "Bandeiras baixadas com sucesso!"
      # --- FIM DO TRUQUE ---

      - name: Instalar Dependências do Linux
        run: |
          sudo apt-get update
          sudo apt-get install -y libcairo2-dev pkg-config python3-dev

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Instalar Bibliotecas
        run: |
          pip install pycairo
          # Instala dependências extras se existirem
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Rodar o Cook
        run: python cook.py

      - name: Salvar Imagens
        run: |
          git config --global user.name 'Bot Cozinheiro'
          git config --global user.email 'bot@noreply.github.com'
          git add img_bandeiras
          git commit -m "Novas bandeiras geradas" || echo "Nada novo para salvar"
          git push
