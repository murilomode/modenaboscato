name: Gerar Bandeiras

on:
  schedule:
    - cron: '0 0 * * *' # Roda todo dia à meia-noite
  workflow_dispatch: # Permite rodar manualmente

permissions:
  contents: write

jobs:
  cozinhar:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Baixar Ingredientes Frescos (Forçar Substituição)
        run: |
          # 1. Baixa o código original
          wget https://github.com/antooro/FlagsMashupBot/archive/refs/heads/master.zip -O kit.zip
          unzip -q kit.zip
          
          # 2. MODO TRATOR: Copia tudo por cima do que já existe (-f = force)
          # Isso garante que formatsvg.py e countries estejam perfeitos
          cp -rf FlagsMashupBot-master/* .
          
          # 3. Garante a pasta de bandeiras
          if [ -d "FlagsMashupBot-master/flags" ]; then cp -rf FlagsMashupBot-master/flags .; fi
          
          # 4. Limpeza
          rm kit.zip
          rm -rf FlagsMashupBot-master
          
          # 5. Lista os arquivos só para termos certeza no log (opcional, para debug)
          ls -F

      - name: Instalar Dependências do Linux
        run: |
          sudo apt-get update
          sudo apt-get install -y libcairo2-dev pkg-config python3-dev

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Instalar Bibliotecas
        run: |
          pip install pycairo
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Rodar o Cook
        run: python cook.py

      - name: Salvar Imagens
        run: |
          git config --global user.name 'Bot Cozinheiro'
          git config --global user.email 'bot@noreply.github.com'
          git add img_bandeiras
          git commit -m "Novas bandeiras geradas" || echo "Nada novo para salvar"
          git push
